> 参考文档 https://zhuanlan.zhihu.com/p/425151447, https://www.cnblogs.com/baixianlong/p/12644027.htmlshardingjdbc.sql
# 关于分库分表的思考

## 分库分表为了什么？
分库分表就是为了解决由于数据量过大而导致数据库性能（IO瓶颈，CPU瓶颈）降低的问题，将原来独立的数据库拆分成若干数据库组成 ，将数据大表拆分成若干数据表组成，使得单一数据库、单一数据表的数据量变小，从而达到提升数据库性能的目的。

## 数据库的分区、垂直分库、垂直分表、水平分库、水平分表各自解决那些问题？

### 分区表
* 分区表的分区方式有range、list、hash、key四种方式，但常用的是range、list方式
* 分区表可以单独对分区数据进行操作，在特定的场景下，方便对数据的老化和查询
* 分区表可以提高单表的存储，并且数据还可以分布在不同的物理设备上

### 垂直分库
* 解决业务层面的耦合，业务清晰
* 能对不同业务的数据进行分级管理、维护、监控、扩展等
* 高并发场景下，垂直分库一定程度的提升IO、数据库连接数、降低单机硬件资源的瓶颈

### 垂直分表（将一张表拆成多张表）
* 为了避免IO争抢并减少锁表的几率
* 充分发挥热数据的操作效率
* 可以把不常用的字段单独放在一张表，如一些详细信息以及text，blob等大字段

### 水平分库
* 解决了单库大数据，高并发的性能瓶颈
* 提高了系统的稳定性及可用性

### 水平分表
* 优化单一表数据量过大而产生的性能问题
* 避免IO争抢并减少锁表的几率

## 分库分表的策略一般在什么情况下使用，使用哪种？
* 首先一般来说，在系统设计阶段就应该根据业务耦合松紧来确定垂直分库、垂直分表的方案。
* 当数据量随着业务凉的提升不断增大，但访问压力还不是特别大的情况下，我们首先考虑缓存、读写分离、索引等技术方案。
* 当数据量增长到特别大且持续增长时，即将或者已经出现性能瓶颈时，再考虑水平分库水平分表的方案。

## 水平分库表如何解决扩容、热点问题？
#### 最好的方式莫过于设计前期对数据量的正确预估和业务场景的判断，尽量避免后期出现热点问题和扩容问题。
#### 对于通过hash取模方案，没有热点问题，但会出现扩容问题，解决方案有：
* 停服迁移
* 升级从库
* 双写迁移
#### 对于通过range方案，无需迁移数据，但肯能出现热点问题。所以在实际业务中，我们可以通过range+hash的配合使用来达到即支持扩容又尽可能避免热点。

## 分库分表如何解决跨库事务？
* 2PC两阶段提交协议
* TCC事务补偿机制
* 最终一致性方案
* 最大努力通知型


